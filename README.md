Mattermost on Flynn
===================

This is a small project to deploy [Mattermost](https://mattermost.com/) to
a [Flynn](http://flynn.io/) cluster.

## Setup

Create an application as usual:

```bash
flynn create adminer
```

And add a PostgreSQL appliance: 

```bash
flynn resource add postgres
```

## Initial Deployment and Updates

Push this repository towards Flynn:

```bash
git push flynn master
```

## Version and Type

By default, version 5.1.1 is installed as type "team". You can override this by setting the environment variables `VERSION` (any valid Mattermost version) and `TYPE` ("team" or "enterprise").

## Updates

Just set the environment variable `TYPE` to the version to update to. A redeployment will happen.

## Further Configuration

Any setting from the configuration json file can be overwritten via environment variables. They have a specific scheme to address the configuration key:

`MM_<rootKey>_<childKey>(_<moreChildKeys)`

So for example to override the `SiteURL` from the `ServiceSettings`, this environment variable would be used: `MM_ServiceSettings_SiteURL`.

The port and initial database connections have default values generated by the Flynn environment variables:

```bash
export MM_ServiceSettings_ListenAddress="\":$PORT\""
export MM_SqlSettings_DriverName=${MM_SqlSettings_DriverName:-"\"postgres\""}
export MM_SqlSettings_DataSource=${MM_SqlSettings_DataSource:-"\""$DATABASE_URL?sslmode=disable&connect_timeout=10"\""}
```

So they are always present. But the SqlSettings can be overridden just by setting `MM_SqlSettings_DriverName` and `MM_SqlSettings_DataSource`.

## License

This software is licensed under the
[MIT License](https://opensource.org/licenses/MIT). Adminer itself (index.php)
is licensed under the
[Apache License](https://www.apache.org/licenses/LICENSE-2.0.html).
